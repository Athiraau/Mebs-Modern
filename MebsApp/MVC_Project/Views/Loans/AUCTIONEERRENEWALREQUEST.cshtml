
@{
    ViewData["Title"] = "AUCTIONEERRENEWALREQUEST";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    @*<meta http-equiv="refresh" content="8" />*@

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="~/css/index.css">
    <script src="~/js/site.js"></script>


    <style>

        .completionyear {
            width: 30%;
        }

        .pagecontiner {
            margin-left: 169px;
            width: 930px;
        }

        .form-container {
            border-radius: 8px;
            padding: 15px;
            background-color: #ffff;
            /*box-shadow: 0 2px 5px rgba(17,45,78,1);*/
        }


        .form-control {
            height: 30px;
            font-size: small;
        }

        .form-label {
            font-weight: 500;
            font-size: small;
            margin-top: 13px;
            color: #27005D;
        }

        .label1 {
            font-size: small;
            color: #27005D;
        }

        .btn-grad {
            background-image: linear-gradient(to right, #46211A 100%, #F1D3B2 20%);
            text-transform: uppercase;
            transition: 0.5s;
            width: 100px;
            padding: 6px;
            background-size: 200% auto;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            display: block;
        }

       .btn-grad:hover {
            background-position: right center;
            /* change the direction of the change here */
             color: #fff;
             text-decoration: none;
        }
            

        


        table {
            width: 100%;
            border-collapse: collapse;
            font-size: initial;
        }

        .img1 {
            display: none;
            cursor: pointer;
        }

        th,
        td {
            border: 1px solid white;
            text-align: left;
            padding: 8px;
            font-size: initial;
        }

        th {
            background-color: #f2f2f2;
            font-size: initial;
        }

        .fs-10 {
            font-size: 10px;
        }

        .mt-5 {
            margin-left: -286px;
            width: 928px;
            margin-top: 12px;
        }
    </style>

</head>

<body>
    <asp:HiddenField ID="hdn_sysdate" runat="server" EnableViewState="False" />

    <div class="pagecontiner">
        <div class="form-container" style="background-color:#F1D3B2">

            <div class="mt-5" id="dcontainer2" style="margin-left:272px;">


                <div class="mt-5" style="background-color:#F1D3B2">
                    <table class="table table-striped table-hover" id="your-table-id" style="background-color:#F1D3B2">
                        <thead>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color:#46211A" colspan="8">
                                    RENEWAL OF AUCTIONEER AGREEMENT 
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="8" style="background-color: #F1D3B2">
                                    <div class="form-group row">
                                        <label for="auctioneerid" class="col-sm-3 col-form-label form-label"> SELECT AUCTIONEER </label>
                                        <div class="col-sm-9">
                                            <select id="auctioneerSelect" class="form-control" onchange="callAPIResponse3()">
                                                <option value="SELECT">SELECT</option>

                                            </select>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #46211A" colspan="8">
                                    EXISTING AGREEMENT
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">START DATE:</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="oldstartdate" class="form-control" readonly="readonly"/>
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">END DATE:</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="oldenddate" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">BOARD RESOLUTION DATE:</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="oldresoldate" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                              
                            </tr>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #46211A" colspan="8">
                                   SET NEW AGREEMENT
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">SELECT START DATE:</span>
                                        <div class="col-lg-6 col-md-12 col-sm-12">
                                            <input type="date" id="nwstartdate" value="" name="startdate">

                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">SELECT END DATE:</span>
                                        <div class="col-lg-6 col-md-12 col-sm-12">
                                            <input type="date" id="nwenddate" value="" name="enddate">

                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4" style="background-color:#F1D3B2">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">SELECT BOARD RESOLUTION DATE:</span>
                                        <div class="col-lg-6 col-md-12 col-sm-12">
                                            <input type="date" id="nwresoldate" value="" name="resolutiondate">

                                        </div>
                                    </div>
                                </th>
                               
                            <tr>
                                <th class="table-secondary  text-white text-center" colspan="4" style="background-color: #F1D3B2">
                                    <div class="btn-group  label1">
                                        <button class="btn-grad" id="btnsbmt" onclick="SubmitForm();">APPROVE</button>

                                    </div>

                                </th>
                                
                                <th class="table-secondary  text-white text-center" colspan="4" style="background-color:#F1D3B2">
                                    <div class="btn-group  label1">
                                        <button class="btn-grad" onclick="ExitForm();">EXIT</button>

                                    </div>

                                </th>

                            </tr>


                        </thead>
                    </table>
                </div>
            </div>
        </div>

    </div>
    <script>
        // API GET LOAD
        window.onload = function OnloadFunction() {
            ActiveLoginCheck();
            EmpAccess();

        }
        function ActiveLoginCheck() {
            var user = '@ViewData["EmpCode"]';
            if (user == null || user == '') {
                alert('INACTIVE SESSION');
                loadIndex();
            }

        }
        function ExitForm() {

            var root = '';
            var baselink = '@ViewData["baseurl"]';
            var id = '@ViewData["HeadName"]';

            if (document.location.hostname == 'localhost') {
                window.location.href = "/Loans/Index?datas=" + id;
            }
            else {
                root = '@ViewData["root"]';
                domainurl = baselink + root;
                window.location.href = domainurl + "/Loans/Index?datas=" + id;
            }

        }
        //ACCESSIBILITY
        function EmpAccess() {
            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }

            const EmpCode = '@ViewData["EmpCode"]';

            indata = "Auctioneer_Renewal" + "^" + "EmpAccess" + "~" + EmpCode;

            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {
                    reqs = response;



                }

            });


            reqs = JSON.parse(reqs);
            reqs = reqs[0].RESULT;




            if (reqs > 0) {
                callAPIResponse();

            }
            else {

                alert("You are not Authorised to do this Job");
                ExitForm();
            }
        }
        //dropdown
        function callAPIResponse() {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }



            //ndata = "IND_DEVICE_UPDATION_LOAD" + "^" + "400456";
         
            
            indata = "Auctioneer_Renewal" + "^" + "auctioneer_select" + "~" + 1;
            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    const data2 = JSON.parse(response);
                    LoadDropDown(data2);
                },
                error: function (response) {
                    // alert("failed");
                }
            });
        }

        function LoadDropDown(data2) {
            const options = formatDataAsArray(data2);
            auctioneerSelect.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.text = option.label;
                auctioneerSelect.add(optionElement);
            });
        }

        function formatDataAsArray(data2) {
            if (Array.isArray(data2) && data2.length > 0) {
                return data2.map(item => ({
                    value: item["AUCTIONEER_ID"],
                    label: item["AUCTIONEER_NAME"]
                }));
            } else {
                return [];
            }
        }

        //alert 
        function callAPIResponse3() {
            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }
            
            var aucid = document.getElementById("auctioneerSelect").value;

            indata = "Auctioneer_Renewal" + "^" + "auctioneer_renewal" + "~" + aucid;

            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {
                    reqs = response;



                }

            });


            reqs = JSON.parse(reqs);
            reqs = reqs[0].RESULT;
           



            if (reqs > 0) {
                alert("Auctioneer Have " + reqs + " Days Left For Renewal.");
                resetForm();

            }
            else if (reqs == 0) {
                callAPIResponse1();
            }
        }



        //fetch data
        function callAPIResponse1() {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }



            var aucid = document.getElementById("auctioneerSelect").value;

            indata = "Auctioneer_Renewal" + "^" + "auctioneer_details" + "~" + aucid;
            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    const data3 = JSON.parse(response);

                    loadDataAuc(data3);


                    r
                },
                error: function (response) {
                    // alert("failed");
                }
            });
        }


        function loadDataAuc(data) {




            data.forEach(item => {


                document.getElementById('oldstartdate').value = item.START_DT;
                document.getElementById('oldenddate').value = item.END_DT;
                document.getElementById('oldresoldate').value = item.RESOLUTION_DT;

                // alert(item.AUCTIONEER_NAME);

            });


        }

        function resetForm() {
            var root = '';
            var baselink = '@ViewData["baseurl"]';
            var id = '@ViewData["HeadName"]';

            if (document.location.hostname == 'localhost') {
                window.location.href = "/loans/auctioneerrenewalrequest?datas=" + id;
            }
            else {
                root = '@ViewData["root"]';
                domainurl = baselink + root;
                window.location.href = domainurl + "/loans/auctioneerrenewalrequest?datas=" + id;
            }


        }
        // VALIDATION FOR DATE SELECT
        nwstartdate.onkeyup = function () {

            OnkeyUpChqDate()
        }
        function OnkeyUpChqDate() {
            if (document.getElementById("nwstartdate").value != "") {
                alert("Select Date from Calender ..!!!!");
                document.getElementById("nwstartdate").value = document.getElementById("hdn_sysdate").value;
            }
        }

        nwenddate.onkeyup = function () {

            OnkeyUpChqDate1()
        }
        function OnkeyUpChqDate1() {
            if (document.getElementById("nwenddate").value != "") {
                alert("Select Date from Calender ..!!!!");
                document.getElementById("nwenddate").value = document.getElementById("hdn_sysdate").value;
            }
        }

        nwresoldate.onkeyup = function () {

            OnkeyUpChqDate2()
        }
        function OnkeyUpChqDate2() {
            if (document.getElementById("nwresoldate").value != "") {
                alert("Select Date from Calender ..!!!!");
                document.getElementById("nwresoldate").value = document.getElementById("hdn_sysdate").value;
            }
        }

        
        // DISABLE PAST DATE
            function disablePastDates1(dateInputId) {
                const dateInput = document.getElementById('nwenddate');

                const today = new Date();
                dateInput.setAttribute('min', today.toISOString().split('T')[0]);

            }
            disablePastDates1('nwenddate');


        nwenddate.onblur = function () {
            CheckValidation()
        }
        
        function CheckValidation() {
            var fromdate = document.getElementById("nwstartdate").value;
            var todate = document.getElementById("nwenddate").value;
            if (todate > fromdate) {
                alert("Cannot Select Agreement Start Date Greater than Agreement End Date..!!!!");

                return false;
            }
        }
        nwresoldate.onblur = function () {
            CheckValidationDate()
        }

        function CheckValidationDate() {
            var fromdate = document.getElementById("nwstartdate").value;
            var Resoldate = document.getElementById("nwresoldate").value;
            if (Resoldate > fromdate) {
                alert("Start date cannot be less than Board resolution date..!!!!");

                return false;
            }
        }
        //date fetch
        function fetchDate() {
            var getdate = document.getElementById('nwstartdate').value;
            //alert(getdate);

            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

            const [year, month, day] = getdate.split("-");
            const formattedMonth = months[parseInt(month, 10) - 1];
            const formattedDate = `${day}-${formattedMonth}-${year}`;
            /// document.getElementById("processDate").innerHTML = formattedDate;
            return formattedDate;
        }
        function fetchDate1() {
            var getdate = document.getElementById('nwenddate').value;
            //alert(getdate);

            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

            const [year, month, day] = getdate.split("-");
            const formattedMonth = months[parseInt(month, 10) - 1];
            const formattedDate = `${day}-${formattedMonth}-${year}`;
            /// document.getElementById("processDate").innerHTML = formattedDate;
            return formattedDate;
        }
        function fetchDate2() {
            var getdate = document.getElementById('nwresoldate').value;
            //alert(getdate);

            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

            const [year, month, day] = getdate.split("-");
            const formattedMonth = months[parseInt(month, 10) - 1];
            const formattedDate = `${day}-${formattedMonth}-${year}`;
            /// document.getElementById("processDate").innerHTML = formattedDate;
            return formattedDate;
        }
        //submit
        function SubmitForm() {

            const EmpCode = '@ViewData["EmpCode"]';
            const Br_Id = '@ViewData["BrID"]';
            var aucid = document.getElementById("auctioneerSelect").value;
            const nw_start_dt = fetchDate();
            const nw_end_dt = fetchDate1();
            const nw_resoldate = fetchDate2();

           // validation
            if (aucid == "-1") {
                alert("Select Auctioneer..!")
                return;
            }

            if (document.getElementById("nwstartdate").value == "") {
                alert("Please Select Agreement Start Date..!")
                return;
            }
            if (document.getElementById("nwenddate").value == "") {
                alert("Please Select Agreement End Date..!")
                return;
            }
            if (document.getElementById("nwresoldate").value == "") {
                alert("Please Select Board Resolution  Date..!")
                return;
            }

            if (nw_end_dt < nw_start_dt) {
                alert("Cannot Select Agreement Start Date Greater than Agreement End Date..!!!!");

                return false;
            }
            if (nw_resoldate > nw_start_dt) {
                alert("Start date cannot be less than Board resolution date..!!!!");

                return false;
            }
            
            var indata = aucid + "*" + nw_start_dt + "*" + nw_end_dt + "*" + EmpCode + "*" + Br_Id + "*" + nw_resoldate;
            SubmitFormAPICall(indata);
            alert(slno);
            resetForm();
            
            callAPIResponse();
        }

        function SubmitFormAPICall(indata) {
            
            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }


            indata = "Auctioneer_Renewal" + "^" + "Submit_Renewal" + "~" + indata;
            const a = "";
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    // alert(response);
                    slno = response;

                },
                error: function (response) {
                    check = 0;
                    //   alert("failed");
                }
            });

            // slno = slno.replace(/[&\/\\#,+()$~%.'"*?<>{}]/g, ''); //slno.replace("[", "");
            // slno = slno.replace("]", " ");
            // slno = slno.replace("[", " ");
            // slno = slno.split(':')

            slno=JSON.parse(slno);
            slno = slno[0].RESULT;
            
           
        }


    </script>
</body>
</html>

