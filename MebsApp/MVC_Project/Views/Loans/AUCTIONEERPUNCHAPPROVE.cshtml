@{
    ViewData["Title"] = "AUCTIONEERPUNCHAPPROVE";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="~/css/index.css">
    <script src="~/js/site.js"></script>


    <style>

        .completionyear {
            width: 30%;
        }

        .pagecontiner {
            margin-left: auto;
            width: auto;
        }

        .form-container {
            border-radius: 8px;
            padding: 15px;
            background-color: #ffff;
            /*box-shadow: 0 2px 5px rgba(17,45,78,1);*/
        }


        .form-control {
            height: 30px;
            font-size: small;
        }

        .form-label {
            font-weight: 500;
            font-size: small;
            margin-top: 13px;
            color: #27005D;
        }

        .label1 {
            font-size: small;
            color: #27005D;
        }

        .btn {
            display: inline-block;
            padding: 6px 10px;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            background-color: #f0300a;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-grad {
            background-image: linear-gradient(to right, #00246B 100%, #00246B 20%);
            text-transform: uppercase;
            transition: 0.5s;
            width: 100px;
            padding: 6px;
            background-size: 200% auto;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            display: block;
        }


        .btn:hover {
            background-color: pink;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            margin-top: 12px;
        }

            .btn-group .btn {
                margin: 0 50px;
            }



        table {
            width: 100%;
            border-collapse: collapse;
            font-size: initial;
        }

        .img1 {
            display: none;
            cursor: pointer;
        }

        th,
        td {
            border: 1px solid white;
            text-align: left;
            padding: 8px;
            font-size: initial;
        }

        th {
            background-color: #f2f2f2;
            font-size: initial;
        }

        .fs-10 {
            font-size: 10px;
        }

        .mt-5 {
            margin-left: -286px;
            width: 928px;
            margin-top: 12px;
        }
    </style>

</head>

<body>

    <div class="pagecontiner">
        <div class="form-container">

            <div class="mt-5" id="dcontainer2" style="margin-left:272px;">


                <div class="mt-5" style="width: 730px;">
                    <table class="table table-striped table-hover" id="your-table-id">
                        <thead>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #00246B" colspan="8">
                                    AUCTIONEER PUNCHING APPROVAL
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="8">
                                    <div class="form-group row">
                                        <label for="auctioneerid" class="col-sm-3 col-form-label form-label"> SELECT AUCTIONEER ID</label>
                                        <div class="col-sm-9">
                                            <select id="auctioneerSelect" class="form-control" onchange="callAPIResponse1()">
                                                <option value="SELECT">SELECT</option>

                                            </select>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">AUCTIONEER ID</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="auctioneerid" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">NAME</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="auctioneername" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #00246B" colspan="8">
                                    TODAY PUNCHED DETAILS
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">BRANCH</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="branch" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">AREA</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="area" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">DISTRICT</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="district" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">PUNCHED TIME</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="punchtime" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #00246B" colspan="8">
                                    REQUESTING BRANCH
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">BRANCH</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="rqbranch" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">AREA</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="rqarea" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">DISTRICT</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="rqdistrict" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">REQUESTED DATE</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="rqstdt" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">BRANCH HEAD</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="brhead" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">BH REMARK</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="bhremark" class="form-control" readonly="readonly" />
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary text-center text-white" style="background-color: #00246B" colspan="8">
                                    REMARKS
                                </th>
                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="4">
                                    <div class="form-group row">
                                        <span class="col-sm-3 col-form-label form-label">ENTER REMARK</span>
                                        <div class="col-sm-9" style="margin-top:13px">
                                            <input type="text" id="remark" class="form-control" />
                                        </div>
                                    </div>
                                </th>

                            </tr>
                            <tr>
                                <th class="table-secondary  text-white" colspan="3">
                                    <div class="btn-group  label1">
                                        <button class="btn-grad" id="btnsbmt" onclick="SubmitForm();">APPROVE</button>

                                    </div>

                                </th>
                                <th class="table-secondary  text-white" colspan="3">
                                    <div class="btn-group  label1">
                                        <button class="btn-grad" id="btnrejt" onclick="RejectForm();">REJECT</button>

                                    </div>

                                </th>
                                <th class="table-secondary  text-white" colspan="2">
                                    <div class="btn-group  label1">
                                        <button class="btn-grad" onclick="ExitForm();">EXIT</button>

                                    </div>

                                </th>

                            </tr>


                        </thead>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
        //----redirect to index page

        function ExitForm() {

            var root = '';
            var baselink = '@ViewData["baseurl"]';
            var id = '@ViewData["HeadName"]';

            if (document.location.hostname == 'localhost') {
                window.location.href = "/Loans/Index?datas=" + id;
            }
            else {
                root = '@ViewData["root"]';
                domainurl = baselink + root;
                window.location.href = domainurl + "/Loans/Index?datas=" + id;
            }

        }
    </script>

    <script>
        // API GET LOAD
        window.onload = function OnloadFunction() {
            ActiveLoginCheck();
            EmpAccess();

        }
        function ActiveLoginCheck() {
            var user = '@ViewData["EmpCode"]';
            if (user == null || user == '') {
                alert('INACTIVE SESSION');
                loadIndex();
            }

        }
        //ACCESSIBILITY
        function EmpAccess() {
            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }

            const EmpCode = '@ViewData["EmpCode"]';

            indata = "Mebs_Auction" + "^" + "AuctioneerAccess" + "~" + EmpCode;

            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {
                    reqs = response;



                }

            });


            reqs = JSON.parse(reqs);
            reqs = reqs[0].RESULT;




            if (reqs > 0) {
                callAPIResponse();

            }
            else {

                alert("You are not Authorised to do this Job");
                ExitForm();
            }
        }
        //dropdown
        function callAPIResponse() {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }



            const EmpCode = '@ViewData["EmpCode"]';
            indata = "Mebs_Auction" + "^" + "auctioneer_select" + "~" + EmpCode;
            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    const data2 = JSON.parse(response);
                    LoadDropDown(data2);
                },
                error: function (response) {
                    // alert("failed");
                }
            });
        }

        function LoadDropDown(data2) {
            const options = formatDataAsArray(data2);
            auctioneerSelect.innerHTML = '';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.text = option.label;
                auctioneerSelect.add(optionElement);
            });
        }

        function formatDataAsArray(data2) {
            if (Array.isArray(data2) && data2.length > 0) {
                return data2.map(item => ({
                    value: item["AUCTIONEER_ID"],
                    label: item["AUCTIONEER_NAME"]
                }));
            } else {
                return [];
            }
        }
        //fetch data
        function callAPIResponse1() {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/getAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/getAPIData"; }



            var aucid = document.getElementById("auctioneerSelect").value;

            indata = "Mebs_Auction" + "^" + "auctioneer_details" + "~" + aucid;
            var response = '';
            $.ajax({
                type: "GET",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    const data3 = JSON.parse(response);

                    loadDataAuc(data3);



                },
                error: function (response) {
                    // alert("failed");
                }
            });
        }


        function loadDataAuc(data) {




            data.forEach(item => {


                document.getElementById('auctioneerid').value = item.AUCTIONEER_ID;
                document.getElementById('auctioneername').value = item.AUCTIONEER_NAME;
                document.getElementById('branch').value = item.BRANCH;
                document.getElementById('area').value = item.AREA;
                document.getElementById('district').value = item.DISTRICT;
                document.getElementById('punchtime').value = item.PUNCH_DATE;
                document.getElementById('rqbranch').value = item.RQ_BRANCH;
                document.getElementById('rqarea').value = item.RQ_AREA;
                document.getElementById('rqdistrict').value = item.RQ_DISTRICT;
                document.getElementById('rqstdt').value = item.REQ_DT;
                document.getElementById('brhead').value = item.BH_EMPCODE;
                document.getElementById('bhremark').value = item.BH_REMARKS;

                // alert(item.AUCTIONEER_NAME);

            });


        }
        //validations
        function validatefunction() {


            var aucid1 = document.getElementById("auctioneerSelect").value;
            var remark1 = document.getElementById("remark").value;



            // Validate auctioneerId Selection
            if (aucid1 === "0") {
                alert("Please select a AuctioneerId.");
                document.getElementById("btnsbmt").disabled = false;
                return 0;
            }



            // Validate Completion Year
            if (remark1 === "") {
                alert("Please Enter Remark.");
                document.getElementById("btnsbmt").disabled = false;
                return 0;
            }

            // All validations passed
            return 1;
        }
        //submit
        var check = '1';
        var slno = '0';
        function SubmitForm() {
            document.getElementById("btnsbmt").disabled = true;
            var a = validatefunction();



            if (!a == 1)
                return;

            const EmpCode = '@ViewData["EmpCode"]';


            var aucid = document.getElementById("auctioneerSelect").value;
            var brid = document.getElementById("branch").value;

            var ArrNames = brid.split("-");
            var branchid1 = ArrNames[0];//alert(Name1);
            var branchid2 = ArrNames[1];//alert(Name2);

            var rqbrid = document.getElementById("rqbranch").value;

            var ArrNames1 = rqbrid.split("-");
            var reqbranchid1 = ArrNames1[0];//alert(Name1);
            var reqbranchid2 = ArrNames1[1];//alert(Name2);

            var remark = document.getElementById("remark").value;


            var indata = aucid + "*" + branchid1 + "*" + reqbranchid1 + "*" + EmpCode + "*" + remark + "*" + 1;
            PostDataAPICall(indata);
            // alertfunction();


            //   resetForm();
            //   }
        }
        function PostDataAPICall(indata) {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/postAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/postAPIData"; }


            indata = "Auctioneer_PunchCntrl" + "^" + "submitform_app" + "~" + indata;

            const a = "";
            $.ajax({
                type: "POST",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    //alert(response);
                    slno = response;

                },
                error: function (response) {
                    check = 0;
                    //   alert("failed");
                }
            });

            slno = JSON.parse(slno);
            slno = slno[0].RESULT;

            alert(slno);
            resetForm();


        }
        function resetForm() {
            var root = '';
            var baselink = '@ViewData["baseurl"]';
            var id = '@ViewData["HeadName"]';

            if (document.location.hostname == 'localhost') {
                window.location.href = "/loans/auctioneerpunchapprove?datas=" + id;
            }
            else {
                root = '@ViewData["root"]';
                domainurl = baselink + root;
                window.location.href = domainurl + "/loans/auctioneerpunchapprove?datas=" + id;
            }


        }
        //reject
        var check = '1';
        var slno = '0';
        function RejectForm() {
            var a = validatefunction();



            if (!a == 1)
                return;

            const EmpCode = '@ViewData["EmpCode"]';


            var aucid = document.getElementById("auctioneerSelect").value;
            var brid = document.getElementById("branch").value;

            var ArrNames = brid.split("-");
            var branchid1 = ArrNames[0];//alert(Name1);
            var branchid2 = ArrNames[1];//alert(Name2);

            var rqbrid = document.getElementById("rqbranch").value;

            var ArrNames1 = rqbrid.split("-");
            var reqbranchid1 = ArrNames1[0];//alert(Name1);
            var reqbranchid2 = ArrNames1[1];//alert(Name2);

            var remark = document.getElementById("remark").value;


            var indata = aucid + "*" + branchid1 + "*" + reqbranchid1 + "*" + EmpCode + "*" + remark + "*" + 2;
            PostDataAPICall1(indata);

        }
        function PostDataAPICall1(indata) {

            var _link = '';
            if (document.location.hostname == 'localhost') { _link = "/Loans/postAPIData"; }
            else { var root = '@ViewData["root"]'; _link = "/" + root + "/Loans/postAPIData"; }


            indata = "Auctioneer_PunchCntrl" + "^" + "rejectform_app" + "~" + indata;

            const a = "";
            $.ajax({
                type: "POST",
                url: _link,
                data: { datas: indata },
                async: false,
                success: function (response) {

                    //alert(response);
                    slno = response;

                },
                error: function (response) {
                    check = 0;
                    //   alert("failed");
                }
            });



            slno = JSON.parse(slno);
            slno = slno[0].RESULT;

            alert(slno);
            resetForm();


        }


    </script>
</body>
</html>